import * as TreeKill from 'tree-kill'
import { RunningProcess } from '../models'
import { spawn } from 'child_process'

export class AppRunner {

    private static runningProcesses: RunningProcess[]

    constructor() {
        if (!AppRunner.runningProcesses)
            AppRunner.runningProcesses = []
    }

    run(command: string) {
        const child = spawn('sh', [command])
        return {
            pid: child.pid,
            stdout: child.stdout
        }
    }

    isRunning(pid: number): boolean {
        return !!AppRunner.runningProcesses.find(p => p.pid === pid)
    }

    stop(pid: number) {
        const runningProcess = AppRunner.runningProcesses.find(p => p.pid === pid)
        if (runningProcess) {
            TreeKill(runningProcess.pid)
            AppRunner.runningProcesses = AppRunner.runningProcesses.filter(p => p.pid !== pid)
        }
    }
}