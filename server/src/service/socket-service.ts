import { Socket } from 'socket.io'
import { NmapCommand, NmapRunner } from '../commands'
import { ISocketService } from '../interfaces'

const clients: Socket[] = []

export class SocketService implements ISocketService {

  private nmap: NmapRunner

  constructor() {
    this.nmap = new NmapRunner(this)
  }

  addClient(s: Socket) {
    s.on('NMAP_BUNNER_GRABBING', (command: NmapCommand) => this.nmap.bannerGrabbing(command))
    s.on('NMAP_NETWORK_SWEEPING', (command: NmapCommand) => this.nmap.networkSweeping(command))
    clients.push(s)
  }

  notifyClients(type: string, data: string) {
    clients.forEach(p => p.emit(type, data))
  }

}
